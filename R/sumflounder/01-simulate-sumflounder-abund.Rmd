---
title: "Simulate summer flounder abundance"
author: "Angelia Miller"
date: "2023-07-25"
output: html_document
---

## Objective ####
Script will simulate summer flounder population and abundances based on stock assessment data

Output: Initial numbers at age, numbers at length, total mortality at age for a set number of years and ages, and recruitment for a given number of years 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(SimSurvey)
suppressPackageStartupMessages(library(tidyverse))
library(data.table)
library(patchwork)
library(here)

```

_Stock Assessment Data_
Recruitment at age 0 and fishing mortality data are pulled from the Summer Flounder Management Track Assessment for 2021 (Table 1). The natural mortality value and Von Bertalanffy growth parameters are pulled from the 66th Stock Assessment Workshop report (2019).
```{r stock data}
set.seed(8675309)

# Recruitment at age 0 for the most recent year, 2019; numbers were reported in thousands in the MTA report.
Rec_age0 <- 48689*1000
#mean(Rec_age0)
#sd(Rec_age0)

# fishing mortality for the most recent year, 2019
F <- 0.340

# natural mortality
M <- 0.2

#total mortality
Z <- F + M
#mean(Z)
#sd(Z)
#log(sd(Z))

# Von Bertalanffy growth parameters for both male and female
Linf = 83.6
K = 0.14
```


## Simulate Abundance 
```{r sim abundance}

pop <- sim_abundance(ages = 0:7, years = 1:3,
                      R = sim_R(log_mean = log(mean(Rec_age0)), log_sd = 0.001, plot = TRUE),
                      Z = sim_Z(log_mean = log(mean(Z)), log_sd = 0.001, plot = TRUE),
                      growth = sim_vonB(Linf = 83.6, K = 0.14, plot = TRUE))
Nage <- tibble(age = 0:7, pop$N0)
plot_surface(pop, mat = "N")

```


```{r, include = FALSE}
### save the data
saveRDS(pop, here("R", "sumflounder", "data", "sumflounder_abundance.rds"))
saveRDS(Nage, here("R", "sumflounder", "data", "sumflounder_Nage.rds"))
```

